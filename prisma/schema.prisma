generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model UserSettings {
  id          String   @id @default(uuid())
  theme       String   @default("system") // light, dark, system
  accentColor String   @default("violet")
  currency    String   @default("LKR")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Income {
  id        String   @id @default(uuid())
  amount    Float
  category  String
  note      String?
  timestamp DateTime @default(now())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([timestamp])
}

model Expense {
  id        String   @id @default(uuid())
  amount    Float
  category  String
  note      String?
  timestamp DateTime @default(now())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([timestamp])
}

model Debt {
  id             String      @id @default(uuid())
  type           String      // "Lent" or "Borrowed"
  lender         String      // Person/Bank name
  initialAmount  Float
  currentBalance Float
  note           String?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  repayments     Repayment[]

  @@index([createdAt])
}

model Repayment {
  id        String   @id @default(uuid())
  amount    Float
  debtId    String
  debt      Debt     @relation(fields: [debtId], references: [id], onDelete: Cascade)
  timestamp DateTime @default(now())
  note      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([timestamp])
}

model Subscription {
  id            String   @id @default(uuid())
  name          String
  amount        Float
  category      String
  frequency     String   @default("MONTHLY") // MONTHLY, YEARLY, WEEKLY
  nextDueDate   DateTime 
  status        String   @default("ACTIVE") // ACTIVE, CANCELLED
  provider      String?  // e.g. "Netflix", "Dialog"
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([nextDueDate])
}

model Goal {
  id          String   @id @default(uuid())
  name        String
  targetAmount Float
  currentAmount Float @default(0)
  deadline    DateTime?
  status      String   @default("ACTIVE") // ACTIVE, COMPLETED, ARCHIVED
  
  // Auto-save settings
  isAutoSaveEnabled Boolean @default(false)
  autoSaveAmount    Float?
  autoSaveFrequency String? // DAILY, WEEKLY, MONTHLY
  nextAutoSaveDate  DateTime?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
